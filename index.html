<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dice Roller</title>
  <style>
    :root {
      --bg-primary: white;
      --text-primary: #000;
      --text-secondary: #666;
      --border-color: #ddd;
      --hover-bg: rgba(0, 0, 0, 0.05);
      --gradient-start: #667eea;
      --gradient-end: #764ba2;
      --dice-color: #667eea;
      --dice-text-color: white;
    }

    html.dark-mode {
      --bg-primary: #2a2a2a;
      --text-primary: #f0f0f0;
      --text-secondary: #9ca3af;
      --border-color: #4b5563;
      --hover-bg: rgba(255, 255, 255, 0.05);
      --gradient-start: #667eea;
      --gradient-end: #764ba2;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
      font-family: 'Arial', sans-serif;
      transition: background-color 0.3s ease;
    }

    .container {
      text-align: center;
      background: var(--bg-primary);
      color: var(--text-primary);
      padding: 50px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      position: relative;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    h1 {
      color: var(--text-primary);
      margin: 0;
      font-size: 32px;
    }

    .dice-container {
      perspective: 1000px;
      margin-bottom: 30px;
    }

    .multiple-dices {
      display: grid;
      gap: 20px;
      margin: 0 auto;
      width: fit-content;
      justify-items: center;
    }

    .dice {
      width: 120px;
      height: 120px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s ease-out;
    }

    .dice.rolling {
      animation: roll 0.6s ease-out;
    }

    @keyframes roll {
      0% {
        transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);
      }

      100% {
        transform: rotateX(720deg) rotateY(720deg) rotateZ(720deg);
      }
    }

    .dice-face {
      position: absolute;
      width: 120px;
      height: 120px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 60px;
      font-weight: bold;
      color: var(--dice-text-color);
      border: 3px solid #333;
      background-color: var(--dice-color);
      opacity: 0.9;
    }

    .face-1 {
      transform: translateZ(60px);
    }

    .face-2 {
      transform: rotateY(180deg) translateZ(60px);
    }

    .face-3 {
      transform: rotateY(90deg) translateZ(60px);
    }

    .face-4 {
      transform: rotateY(-90deg) translateZ(60px);
    }

    .face-5 {
      transform: rotateX(90deg) translateZ(60px);
    }

    .face-6 {
      transform: rotateX(-90deg) translateZ(60px);
    }

    .result {
      font-size: 28px;
      color: #667eea;
      font-weight: bold;
      margin-bottom: 10px;
      min-height: 40px;
    }

    .roll-button {
      background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .roll-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    }

    .roll-button:active {
      transform: translateY(-1px);
    }

    .roll-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      gap: 20px;
    }

    .icon-group {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-left: auto;
    }

    .config-icon,
    .info-icon,
    .dark-mode-toggle {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid var(--text-secondary);
      background-color: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 14px;
      font-weight: 700;
      transition: all 0.2s ease;
      opacity: 0;
      padding: 0;
    }

    .container:hover .config-icon,
    .container:hover .info-icon,
    .container:hover .dark-mode-toggle {
      opacity: 1;
    }

    .config-icon:hover,
    .info-icon:hover,
    .dark-mode-toggle:hover {
      border-color: var(--text-primary);
      color: var(--text-primary);
      background-color: var(--bg-tertiary, var(--hover-bg));
    }

    /* Moon icon (light mode is active) */
    html:not(.dark-mode) .dark-mode-toggle {
      background-color: #888888;
      color: white;
      border-color: #888888;
    }

    html:not(.dark-mode) .dark-mode-toggle:hover {
      background-color: #999999;
      border-color: #999999;
      color: white;
    }

    /* Sun icon (dark mode is active) */
    html.dark-mode .dark-mode-toggle {
      background-color: #808080;
      color: #1a1a1a;
      border-color: #808080;
    }

    html.dark-mode .dark-mode-toggle:hover {
      background-color: #707070;
      border-color: #707070;
      color: #1a1a1a;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.4);
    }

    .modal.show {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      width: 90%;
    }

    .modal-header {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      margin-bottom: 20px;
    }

    .config-group {
      margin-bottom: 20px;
    }

    .config-label {
      display: block;
      color: #555;
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .config-input {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    .config-input[type="color"] {
      width: 60px;
      height: 60px;
      padding: 5px;
      border: 2px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
    }

    .config-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
      margin-top: 25px;
    }

    .modal-buttons button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .save-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .save-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    .cancel-btn {
      background: #f0f0f0;
      color: #333;
      border: 2px solid #ddd;
    }

    .cancel-btn:hover {
      background: #e0e0e0;
    }

    .combined-result {
      font-size: 18px;
      color: #667eea;
      margin-top: 10px;
    }

    .stats {
      margin-top: 40px;
      padding-top: 30px;
      border-top: 2px solid var(--border-color);
      transition: border-color 0.3s ease;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 15px;
    }

    .stat-item {
      background: var(--bg-tertiary);
      padding: 15px;
      border-radius: 10px;
      color: var(--text-primary);
      transition: background-color 0.3s ease;
    }

    html:not(.dark-mode) .stat-item {
      background: #f5f5f5;
    }

    html.dark-mode .stat-item {
      background: #3d3d3d;
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      text-transform: uppercase;
      margin-bottom: 5px;
    }

    .stat-value {
      font-size: 20px;
      font-weight: bold;
      color: #667eea;
    }

    .reset-btn {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 14px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 15px;
      font-weight: bold;
    }

    .reset-btn:hover {
      background: #ff5252;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
    }

    .reset-btn:active {
      transform: translateY(0);
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header-container">
      <div class="icon-group">
        <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle dark mode">üåô</button>
        <button class="info-icon" onclick="window.open('https://github.com/phase-ducats/dice', '_blank')"
          title="GitHub Repository">i</button>
        <button class="config-icon" onclick="openConfigModal()" title="Configure">‚öôÔ∏è</button>
      </div>
    </div>

    <div class="dice-container">
      <div class="multiple-dices" id="dicesContainer"></div>
    </div>

    <div class="result" id="result"></div>
    <div class="combined-result" id="combinedResult"></div>

    <button class="roll-button" id="rollBtn" onclick="rollDice()">üé≤ Roll</button>

    <div class="stats">
      <p style="color: var(--text-secondary); margin-bottom: 10px;">Statistics</p>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-label">Total Rolls</div>
          <div class="stat-value" id="totalRolls">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Last Roll</div>
          <div class="stat-value" id="lastRoll">-</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Average</div>
          <div class="stat-value" id="average">-</div>
        </div>
      </div>
      <button class="reset-btn" onclick="resetStats()">Reset Statistics</button>
    </div>
  </div>

  <!-- Configuration Modal -->
  <div id="configModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">Configure Dice</div>

      <div class="config-group">
        <label class="config-label" for="numDices">Number of Dices:</label>
        <input type="number" id="numDices" class="config-input" min="1" max="16" value="1">
      </div>

      <div class="config-group">
        <label class="config-label" for="numSides">Sides per Dice:</label>
        <input type="number" id="numSides" class="config-input" min="2" max="100" value="6">
      </div>

      <div class="config-group">
        <label class="config-label" for="diceColor">Dice Color:</label>
        <input type="color" id="diceColor" class="config-input" value="#667eea">
      </div>

      <div class="modal-buttons">
        <button class="save-btn" onclick="saveConfig()">Save</button>
        <button class="cancel-btn" onclick="closeConfigModal()">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    let totalRolls = 0;
    let sumOfRolls = 0;
    let lastRollTotal = 0;
    let isRolling = false;
    let numDices = 1;
    let numSides = 6;
    let diceColor = '#667eea';

    // Calculate contrast text color based on background brightness
    function getContrastColor(hexColor) {
      // Convert hex to RGB
      const r = parseInt(hexColor.slice(1, 3), 16);
      const g = parseInt(hexColor.slice(3, 5), 16);
      const b = parseInt(hexColor.slice(5, 7), 16);
      
      // Calculate luminance using relative luminance formula
      const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
      
      // Return white if dark, black if light
      return luminance > 0.5 ? '#000000' : '#ffffff';
    }

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', () => {
      renderDices();
      // Load dark mode preference from localStorage
      if (localStorage.getItem('darkMode') === 'true') {
        document.documentElement.classList.add('dark-mode');
      }
      // Load dice color from localStorage
      const savedColor = localStorage.getItem('diceColor');
      if (savedColor) {
        diceColor = savedColor;
        const textColor = getContrastColor(diceColor);
        document.documentElement.style.setProperty('--dice-color', diceColor);
        document.documentElement.style.setProperty('--dice-text-color', textColor);
      } else {
        // Set default text color for default dice color
        const textColor = getContrastColor(diceColor);
        document.documentElement.style.setProperty('--dice-text-color', textColor);
      }
    });

    function toggleDarkMode() {
      const isDarkMode = document.documentElement.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', isDarkMode);
    }

    function renderDices() {
      const container = document.getElementById('dicesContainer');
      container.innerHTML = '';

      // Calculate grid columns to form a square
      const cols = Math.ceil(Math.sqrt(numDices));
      container.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

      for (let i = 0; i < numDices; i++) {
        const diceDiv = document.createElement('div');
        diceDiv.className = 'dice';
        diceDiv.id = `dice-${i}`;

        // Create dice faces
        for (let face = 1; face <= Math.min(numSides, 6); face++) {
          const faceDiv = document.createElement('div');
          faceDiv.className = `dice-face face-${face}`;
          faceDiv.textContent = face;
          diceDiv.appendChild(faceDiv);
        }

        container.appendChild(diceDiv);
      }
    }

    function rollDice() {
      if (isRolling) return;

      isRolling = true;
      const rollBtn = document.getElementById('rollBtn');
      rollBtn.disabled = true;

      const rolls = [];
      for (let i = 0; i < numDices; i++) {
        const randomNumber = Math.floor(Math.random() * numSides) + 1;
        rolls.push(randomNumber);
      }

      // Add rolling animation
      for (let i = 0; i < numDices; i++) {
        const dice = document.getElementById(`dice-${i}`);
        dice.classList.add('rolling');
      }

      // Animate rolling with more realistic motion
      let animationCount = 0;
      const totalFrames = 30;
      const animationInterval = setInterval(() => {
        for (let i = 0; i < numDices; i++) {
          const dice = document.getElementById(`dice-${i}`);

          // Consistent spinning animation throughout
          const rotateX = Math.random() * 360;
          const rotateY = Math.random() * 360;
          const rotateZ = Math.random() * 360;

          dice.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) rotateZ(${rotateZ}deg)`;
        }
        animationCount++;

        if (animationCount > totalFrames) {
          clearInterval(animationInterval);

          // Show final results
          lastRollTotal = rolls.reduce((a, b) => a + b, 0);
          totalRolls++;
          sumOfRolls += lastRollTotal;

          for (let i = 0; i < numDices; i++) {
            const dice = document.getElementById(`dice-${i}`);
            dice.classList.remove('rolling');
            dice.style.transform = getRotation(rolls[i]);
          }

          const resultText = numDices === 1
            ? `You rolled a ${rolls[0]}!`
            : `You rolled: ${rolls.join(', ')}`;

          document.getElementById('result').textContent = resultText;
          document.getElementById('combinedResult').textContent = numDices > 1
            ? `Total: ${lastRollTotal}`
            : '';

          document.getElementById('totalRolls').textContent = totalRolls;
          document.getElementById('lastRoll').textContent = lastRollTotal;
          document.getElementById('average').textContent = (sumOfRolls / totalRolls).toFixed(2);

          isRolling = false;
          rollBtn.disabled = false;
        }
      }, 30);
    }

    function getRotation(faceNumber) {
      const rotations = {
        1: 'rotateX(0deg) rotateY(0deg)',
        2: 'rotateX(0deg) rotateY(180deg)',
        3: 'rotateX(0deg) rotateY(-90deg)',
        4: 'rotateX(0deg) rotateY(90deg)',
        5: 'rotateX(-90deg) rotateY(0deg)',
        6: 'rotateX(90deg) rotateY(0deg)'
      };
      return rotations[faceNumber] || 'rotateX(0deg) rotateY(0deg)';
    }

    function openConfigModal() {
      document.getElementById('numDices').value = numDices;
      document.getElementById('numSides').value = numSides;
      document.getElementById('diceColor').value = diceColor;
      document.getElementById('configModal').classList.add('show');
    }

    function closeConfigModal() {
      document.getElementById('configModal').classList.remove('show');
    }

    function saveConfig() {
      const dices = parseInt(document.getElementById('numDices').value);
      const sides = parseInt(document.getElementById('numSides').value);
      const color = document.getElementById('diceColor').value;

      if (dices < 1 || dices > 16 || sides < 2 || sides > 100) {
        alert('Please enter valid values:\nDices: 1-16\nSides: 2-100');
        return;
      }

      numDices = dices;
      numSides = sides;
      diceColor = color;

      // Update CSS variables for dice color and text color
      const textColor = getContrastColor(diceColor);
      document.documentElement.style.setProperty('--dice-color', diceColor);
      document.documentElement.style.setProperty('--dice-text-color', textColor);

      // Save color to localStorage
      localStorage.setItem('diceColor', diceColor);

      renderDices();
      closeConfigModal();

      // Reset stats on configuration change
      totalRolls = 0;
      sumOfRolls = 0;
      lastRollTotal = 0;
      document.getElementById('result').textContent = '';
      document.getElementById('combinedResult').textContent = '';
      document.getElementById('totalRolls').textContent = '0';
      document.getElementById('lastRoll').textContent = '-';
      document.getElementById('average').textContent = '-';
    }

    function resetStats() {
      if (confirm('Are you sure you want to reset all statistics?')) {
        totalRolls = 0;
        sumOfRolls = 0;
        lastRollTotal = 0;
        document.getElementById('result').textContent = '';
        document.getElementById('combinedResult').textContent = '';
        document.getElementById('totalRolls').textContent = '0';
        document.getElementById('lastRoll').textContent = '-';
        document.getElementById('average').textContent = '-';
      }
    }    // Close modal when clicking outside
    window.addEventListener('click', (e) => {
      const modal = document.getElementById('configModal');
      if (e.target === modal) {
        closeConfigModal();
      }
    });

    // Allow rolling with Enter key
    document.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        rollDice();
      }
    });
  </script>
</body>

</html>